// Traducciones
const translations = {
    es: {
        'title': 'Abderrahman Belaziz',
        'subtitle': 'Desarrollador multiplataforma',
        'carta-label': 'Carta Presentaci√≥n',
        'formacion-label': 'Formaci√≥n',
        'proyectos-label': 'Proyectos',
        'contacto-label': 'Contacto',
        'carta-title': 'Carta de Presentaci√≥n',
        'formacion-title': 'Formaci√≥n',
        'proyectos-title': 'Proyectos',
        'contacto-title': 'Contacto',
        'carta-greeting': '¬°Hola!',
        'carta-intro': 'Soy <strong>Abderrahman Belaziz</strong>, puedes llamarme <strong>Abdel</strong>.',
        'carta-description': 'Soy un estudiante de Formaci√≥n Profesional de Grado Superior en Desarrollo de Aplicaciones Multiplataforma. Siempre he sentido curiosidad por la programaci√≥n y el desarrollo de aplicaciones, por lo que decid√≠ enfocar todos mis esfuerzos en las mismas.',
        'carta-skills': 'Me pongo en contacto con ustedes con el fin de poder realizar mis pr√°cticas de formaci√≥n profesional en su empresa, y as√≠ poder conocer a su equipo y poder aprender de √©l, y aportar todo lo posible al mismo.',
        'carta-experience': 'Es cierto que no cuento con la experiencia de un profesional, pero he tenido un recorrido por el mercado laboral que me ha aportado muchas cualidades y habilidades que considero valiosas como la manera correcta de tratar con el cliente, ventas, lidiar con conflictos con compa√±eros y m√°s habilidades que os contar√© en la entrevista.',
        'carta-closing': 'Muchas gracias, y que teng√°is un excelente d√≠a.',
        'formacion-titulo1': 'üéì Formaci√≥n Acad√©mica',
        'formacion-carrera1': 'G.S. Desarrollo de Aplicaciones Multiplataforma',
        'formacion-instituto1': 'IES Doctor Balmis | Alicante, Espa√±a',
        'formacion-fecha1': '2024 - 2026',
        'formacion-carrera2': 'Bachillerato Cient√≠fico',
        'formacion-instituto2': 'IES Virgen Del Remedio | Alicante, Espa√±a',
        'formacion-fecha2': '2022 - 2024',
        'formacion-experiencia': 'üíº Experiencia Laboral',
        'formacion-empresa': 'Sara Mobiles Shop',
        'formacion-cargo': 'Atenci√≥n al cliente y ventas',
        'formacion-fecha-exp': '2021 ‚Äì ACTUALIDAD',
        'formacion-duties1': 'Atenci√≥n directa a clientes',
        'formacion-duties2': 'Venta de tel√©fonos m√≥viles y accesorios',
        'formacion-duties3': 'Resoluci√≥n de incidencias',
        'formacion-idiomas': 'üåç Idiomas',
        'idioma-espanol': 'Espa√±ol:',
        'idioma-nativo': 'Nativo',
        'idioma-ingles': 'Ingl√©s:',
        'idioma-profesional': 'Profesional',
        'idioma-arabe': '√Årabe:',
        'idioma-nativo2': 'Nativo',
        'proyecto-tecnologias': 'üíª Tecnolog√≠as',
        'proyecto-frontend': 'Frontend & M√≥vil',
        'proyecto-desktop': 'Escritorio',
        'proyecto-backend': 'Backend',
        'proyecto-gestion': 'Gesti√≥n de Proyectos',
        'proyecto-folder': 'üìÅ Proyectos',
        'proyecto-proximamente': 'Pr√≥ximamente...',
        'contacto-titulo': 'üìß Contacto',
        'contacto-descripcion': 'Estoy siempre abierto a nuevas oportunidades, colaboraciones o simplemente a conocer a otros desarrolladores. No dudes en contactarme.',
        'contacto-email-label': 'Email:',
        'contacto-telefono-label': 'Tel√©fono:',
        'contacto-email': 'alexanderkalashnicovx@gmail.com',
        'contacto-telefono': '602 364 375',
        'contacto-cierre': '¬°Espero tu mensaje! üöÄ'
    },
    en: {
        'title': 'Abderrahman Belaziz',
        'subtitle': 'Cross-platform Developer',
        'carta-label': 'Cover Letter',
        'formacion-label': 'Education',
        'proyectos-label': 'Projects',
        'contacto-label': 'Contact',
        'carta-title': 'Cover Letter',
        'formacion-title': 'Education',
        'proyectos-title': 'Projects',
        'contacto-title': 'Contact',
        'carta-greeting': 'Hello!',
        'carta-intro': 'I am <strong>Abderrahman Belaziz</strong>, you can call me <strong>Abdel</strong>.',
        'carta-description': 'I am a Higher Vocational Training student in Cross-platform Application Development. I have always been curious about programming and application development, which is why I decided to focus all my efforts on them.',
        'carta-skills': 'I am contacting you with the aim of being able to carry out my professional training internships at your company, and thus be able to meet your team and learn from them, and contribute everything possible to them.',
        'carta-experience': 'It is true that I do not have the experience of a professional, but I have had a journey through the labor market that has given me many qualities and skills that I consider valuable, such as the correct way to deal with customers, sales, dealing with conflicts with colleagues, and more skills that I will tell you about in the interview.',
        'carta-closing': 'Thank you very much, and have an excellent day.',
        'formacion-titulo1': 'üéì Academic Education',
        'formacion-carrera1': 'H.V.T. Cross-platform Application Development',
        'formacion-instituto1': 'IES Doctor Balmis | Alicante, Spain',
        'formacion-fecha1': '2024 - 2026',
        'formacion-carrera2': 'Science Baccalaureate',
        'formacion-instituto2': 'IES Virgen Del Remedio | Alicante, Spain',
        'formacion-fecha2': '2022 - 2024',
        'formacion-experiencia': 'üíº Work Experience',
        'formacion-empresa': 'Sara Mobiles Shop',
        'formacion-cargo': 'Customer service and sales',
        'formacion-fecha-exp': '2021 ‚Äì CURRENT',
        'formacion-duties1': '‚Ä¢ Direct customer service',
        'formacion-duties2': '‚Ä¢ Mobile phone and accessories sales',
        'formacion-duties3': '‚Ä¢ Incident resolution',
        'formacion-idiomas': 'üåç Languages',
        'idioma-espanol': 'Spanish:',
        'idioma-nativo': 'Native',
        'idioma-ingles': 'English:',
        'idioma-profesional': 'Professional',
        'idioma-arabe': 'Arabic:',
        'idioma-nativo2': 'Native',
        'proyecto-tecnologias': 'üíª Technologies',
        'proyecto-frontend': 'Frontend & Mobile',
        'proyecto-desktop': 'Desktop',
        'proyecto-backend': 'Backend',
        'proyecto-gestion': 'Project Management',
        'proyecto-folder': 'üìÅ Projects',
        'proyecto-proximamente': 'Coming soon...',
        'contacto-titulo': 'üìß Contact',
        'contacto-descripcion': 'I am always open to new opportunities, collaborations, or simply meeting other developers. Don\'t hesitate to contact me.',
        'contacto-email-label': 'Email:',
        'contacto-telefono-label': 'Phone:',
        'contacto-email': 'alexanderkalashnicovx@gmail.com',
        'contacto-telefono': '602 364 375',
        'contacto-cierre': 'I look forward to your message! üöÄ'
    }
};

// Funcionalidad para abrir y cerrar ventanas
document.addEventListener('DOMContentLoaded', function() {
    const icons = document.querySelectorAll('.desktop-icon');
    const closeButtons = document.querySelectorAll('.window-close');
    const taskbarApps = document.getElementById('taskbar-apps');
    
    // Estado de la aplicaci√≥n
    let currentLanguage = localStorage.getItem('language') || 'es';
    let isDarkMode = localStorage.getItem('darkMode') === 'true';
    
    // Aplicar estado guardado
    if (isDarkMode) {
        document.body.classList.add('dark-mode');
        document.getElementById('theme-toggle').classList.add('dark-mode');
        document.querySelector('.theme-icon').textContent = '‚òÄÔ∏è';
    }
    
    updateLanguage(currentLanguage);
    
    // Mapeo de ventanas a t√≠tulos e √≠conos (se actualiza con traducciones)
    function getWindowInfo(windowId) {
        const titles = {
            'carta': translations[currentLanguage]['carta-title'],
            'formacion': translations[currentLanguage]['formacion-title'],
            'proyectos': translations[currentLanguage]['proyectos-title'],
            'contacto': translations[currentLanguage]['contacto-title']
        };
        const icons = {
            'carta': 'Assets/CartaPresentacion.png',
            'formacion': 'Assets/Formacion.png',
            'proyectos': 'Assets/dev_to_icon_130961.png',
            'contacto': 'Assets/Contacto.png'
        };
        return { title: titles[windowId], icon: icons[windowId] };
    }
    
    const openWindows = new Map(); // Para rastrear ventanas abiertas

    // Funci√≥n para cambiar idioma
    function updateLanguage(lang) {
        currentLanguage = lang;
        localStorage.setItem('language', lang);
        
        document.documentElement.lang = lang;
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            if (translations[lang][key]) {
                // Si contiene HTML tags, usar innerHTML, si no, usar textContent
                if (translations[lang][key].includes('<')) {
                    element.innerHTML = translations[lang][key];
                } else {
                    element.textContent = translations[lang][key];
                }
            }
        });
        
        // Actualizar texto del bot√≥n de idioma en la barra de tareas
        const languageIconTaskbar = document.querySelector('.language-icon-taskbar');
        if (languageIconTaskbar) {
            languageIconTaskbar.textContent = lang.toUpperCase();
        }
        
        // Actualizar botones de la barra de tareas
        document.querySelectorAll('.taskbar-app').forEach(btn => {
            const windowId = btn.getAttribute('data-window-id');
            const info = getWindowInfo(windowId);
            const titleSpan = btn.querySelector('.taskbar-app-title');
            if (titleSpan && info) {
                titleSpan.textContent = info.title;
            }
        });
    }
    
    // Funci√≥n para cambiar tema
    function toggleTheme() {
        isDarkMode = !isDarkMode;
        localStorage.setItem('darkMode', isDarkMode);
        
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.querySelector('.theme-icon');
        
        if (isDarkMode) {
            document.body.classList.add('dark-mode');
            themeToggle.classList.add('dark-mode');
            themeIcon.textContent = '‚òÄÔ∏è';
            setTimeout(() => {
                themeToggle.classList.remove('dark-mode');
            }, 500);
        } else {
            document.body.classList.remove('dark-mode');
            themeIcon.textContent = 'üåô';
        }
    }
    
    // Men√∫ desplegable del header
    const menuBtn = document.getElementById('header-menu-btn');
    const dropdownMenu = document.getElementById('header-dropdown-menu');
    const menuItems = dropdownMenu.querySelectorAll('.menu-item');
    
    // Toggle del men√∫ desplegable
    menuBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        dropdownMenu.classList.toggle('show');
    });
    
    // Cerrar el men√∫ al hacer clic fuera
    document.addEventListener('click', function(e) {
        if (!menuBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
            dropdownMenu.classList.remove('show');
        }
    });
    
    // Abrir ventanas desde el men√∫
    menuItems.forEach(item => {
        item.addEventListener('click', function() {
            const windowId = this.getAttribute('data-window');
            const window = document.getElementById(`window-${windowId}`);
            
            if (window) {
                closeAllWindowsExcept(windowId);
                window.style.display = 'flex';
                bringToFront(window);
                updateTaskbar(windowId, true);
                dropdownMenu.classList.remove('show');
            }
        });
    });
    
    // Event listeners para los botones de control
    document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    document.getElementById('language-toggle').addEventListener('click', function() {
        currentLanguage = currentLanguage === 'es' ? 'en' : 'es';
        updateLanguage(currentLanguage);
    });
    
    // Funci√≥n para crear bot√≥n en la barra de tareas
    function createTaskbarButton(windowId) {
        const info = getWindowInfo(windowId);
        if (!info) return null;
        
        const button = document.createElement('div');
        button.className = 'taskbar-app';
        button.setAttribute('data-window-id', windowId);
        
        button.innerHTML = `
            <img src="${info.icon}" alt="${info.title}" class="taskbar-app-icon">
            <span class="taskbar-app-title">${info.title}</span>
        `;
        
        button.addEventListener('click', function() {
            toggleWindow(windowId);
        });
        
        return button;
    }
    
    // Funci√≥n para a√±adir o actualizar bot√≥n en la barra de tareas
    function updateTaskbar(windowId, isOpen) {
        const existingButton = document.querySelector(`[data-window-id="${windowId}"]`);
        
        if (isOpen && !existingButton) {
            const button = createTaskbarButton(windowId);
            if (button) {
                taskbarApps.appendChild(button);
                openWindows.set(windowId, button);
            }
        } else if (!isOpen && existingButton) {
            existingButton.remove();
            openWindows.delete(windowId);
        }
        
        updateActiveTaskbarButton(windowId);
    }
    
    // Funci√≥n para actualizar el estado activo de los botones de la barra de tareas
    function updateActiveTaskbarButton(activeWindowId) {
        const buttons = document.querySelectorAll('.taskbar-app');
        buttons.forEach(button => {
            const windowId = button.getAttribute('data-window-id');
            if (windowId === activeWindowId) {
                button.classList.add('active');
            } else {
                button.classList.remove('active');
            }
        });
    }
    
    // Funci√≥n para abrir/cerrar ventanas
    function toggleWindow(windowId) {
        const window = document.getElementById(`window-${windowId}`);
        if (!window) return;
        
        const isVisible = window.style.display !== 'none';
        
        if (isVisible) {
            // Si est√° visible, minimizar
            window.style.display = 'none';
            updateTaskbar(windowId, false);
        } else {
            // Si est√° oculta, cerrar otras y mostrar esta
            closeAllWindowsExcept(windowId);
            window.style.display = 'flex';
            bringToFront(window);
            updateTaskbar(windowId, true);
        }
    }

    // Funci√≥n para cerrar todas las ventanas excepto la especificada
    function closeAllWindowsExcept(exceptWindowId) {
        const allWindows = document.querySelectorAll('.window');
        allWindows.forEach(win => {
            const winId = win.id.replace('window-', '');
            if (winId !== exceptWindowId) {
                win.style.display = 'none';
                updateTaskbar(winId, false);
            }
        });
    }

    // Abrir ventanas al hacer clic en los √≠conos
    icons.forEach(icon => {
        icon.addEventListener('click', function() {
            const windowId = this.getAttribute('data-window');
            const window = document.getElementById(`window-${windowId}`);
            
            if (window) {
                if (window.style.display === 'none' || !window.style.display) {
                    // Cerrar todas las otras ventanas
                    closeAllWindowsExcept(windowId);
                    // Abrir la ventana seleccionada
                    window.style.display = 'flex';
                    bringToFront(window);
                    updateTaskbar(windowId, true);
                } else {
                    // Si ya est√° abierta, solo traerla al frente
                    bringToFront(window);
                    updateActiveTaskbarButton(windowId);
                }
            }
        });
    });

    // Cerrar ventanas
    closeButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.stopPropagation();
            const windowId = this.getAttribute('data-close');
            const window = document.getElementById(`window-${windowId}`);
            
            if (window) {
                window.style.display = 'none';
                updateTaskbar(windowId, false);
            }
        });
    });

    // Hacer las ventanas arrastrables
    const windows = document.querySelectorAll('.window');
    windows.forEach(window => {
        const titlebar = window.querySelector('.window-titlebar');
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;

        titlebar.addEventListener('mousedown', dragStart);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', dragEnd);

        function dragStart(e) {
            if (e.target.classList.contains('window-close')) {
                return;
            }
            
            initialX = e.clientX - xOffset;
            initialY = e.clientY - yOffset;

            if (e.target === titlebar || titlebar.contains(e.target)) {
                isDragging = true;
                bringToFront(window);
                const windowId = window.id.replace('window-', '');
                updateActiveTaskbarButton(windowId);
            }
        }

        function drag(e) {
            if (isDragging) {
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;

                xOffset = currentX;
                yOffset = currentY;

                setTranslate(currentX, currentY, window);
            }
        }

        function dragEnd(e) {
            initialX = currentX;
            initialY = currentY;
            isDragging = false;
        }

        function setTranslate(xPos, yPos, el) {
            el.style.transform = `translate(${xPos}px, ${yPos}px)`;
            el.style.left = '50%';
            el.style.top = '50%';
        }
    });

    // Funci√≥n para traer una ventana al frente
    let zIndexCounter = 100;
    function bringToFront(window) {
        zIndexCounter++;
        window.style.zIndex = zIndexCounter;
        const windowId = window.id.replace('window-', '');
        updateActiveTaskbarButton(windowId);
    }
    
    // Reloj en la barra de tareas
    function updateClock() {
        const clockTimeElement = document.getElementById('clock-time');
        const clockDateElement = document.getElementById('clock-date');
        
        if (clockTimeElement && clockDateElement) {
            const now = new Date();
            
            // Hora
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            clockTimeElement.textContent = `${hours}:${minutes}`;
            
            // Fecha
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            clockDateElement.textContent = `${day}/${month}/${year}`;
        }
    }
    
    // Actualizar el reloj cada minuto
    updateClock();
    setInterval(updateClock, 60000);
});
